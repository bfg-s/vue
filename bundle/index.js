!function(t,e){for(var n in e)t[n]=e[n];e.__esModule&&Object.defineProperty(t,"__esModule",{value:!0})}(exports,(()=>{"use strict";var t={576:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return{data:function(){return{app:t}},beforeMount:function(){},beforeUpdate:function(){t._av[e.id]=this},mounted:function(){t._av[e.id]=this},unmounted:function(){},methods:{}}}},58:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e){return{bind:{},singleton:{},compute:{},provider:null,share:[],with:[],save:[],props:{global_rules:{type:Object}},data:function(){return{app:t}},beforeUpdate:function(){t._cv[e.id]=this},beforeMount:function(){var n=this,o=this.$options.name+(this.$vnode&&this.$vnode.key?"_"+this.$vnode.key:"");this.global_rules&&(t._cv[e.id]=this,Object.keys(e.v).map((function(t){return n[t]=e.v[t]})),this.app.event.on(this.global_rules.id,this.__on_component)),t.obj.each(this.$options.save,(function(e){var r="vue-"+o+"-"+e;if(localStorage.getItem(r)){var i=localStorage.getItem(r),a=t.json.decode(i);n[e]=a||i}else localStorage.setItem(r,"object"==typeof n[e]?t.json.encode(n[e]):n[e]);n.$watch(e,(function(o){localStorage.setItem(r,"object"==typeof n[e]?t.json.encode(n[e]):n[e])}))})),t.obj.each(this.$options.share,(function(e,o){t.num.isNumber(o)&&(o=e),t.vue.watch((function(){return n[o]}),(function(n){t.shared_data[e]=n})),t.vue.watch((function(){return t.shared_data[e]}),(function(t){n[o]=t})),e in t.shared_data?n[o]=t.shared_data[e]:t.shared_data[e]=n[o]})),t.obj.each(this.$options.bind,(function(e,o){t.num.isNumber(o)&&(o=e),t.bind(e,n[o])})),t.obj.each(this.$options.singleton,(function(e,o){t.num.isNumber(o)&&(o=e),t.singleton(e,"function"==typeof n[o]?n[o]:function(){return n[o]})})),t.obj.each(this.$options.compute,(function(e,o){t.num.isNumber(o)&&(o=e),t.compute(e,"function"==typeof n[o]?n[o]:function(){return n[o]})})),this.$options.provider},mounted:function(){t._cv[e.id]=this},beforeUnmount:function(){this.app.event.off(this.global_rules.id,this.__on_component),t.obj.each(this.$options.bind,(function(e){t.forget(e)}))},methods:{__is_contained:function(){return!/^w[0-9]+/.test(String(e.id).split("\\")[1])},__on_component:function(t){var e=this;this.app.obj.each(t,(function(t,n){"_pn"===n?e.app.obj.each(t,(function(t,n){var o=e.app.obj.get(n,e);"function"==typeof o?o.apply(void 0,Array.isArray(t)?t:[t]):e.app.obj.set(n,t[0],e)})):e[n]=t}))}}}}},171:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},a=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var o=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,r++)o[r]=i[a];return o},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=s(n(58)),u=s(n(576));e.default=function(t){return function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.vue_app=null,t.all_components={},t}return r(n,e),n.prototype.build=function(e,n){var o=this,r=Object.assign([],e.childNodes);return this.all_components=t.components.all(),this.vue_app=t.vue.createApp({mixins:[u.default(t,n)],render:function(){return t.schema.wrap_component(n,r)}}),t.obj.each(this.all_components,(function(t,e){return o.vue_app.component(e,t)})),this.vue_app.mount(e,!0).$el},n.prototype.wrap_component=function(e,n){var o,r,s={default:t.vue.withCtx((function(){return t.schema.apply_content(n)}))};if(e.e in this.all_components){var u=c.default(t,e);(o=t.vue.resolveComponent(e.e)).mixins="mixins"in o?a(o.mixins,[u]):[u],r=i(i({global_rules:e},e.a),t.schema.apply_methods(e)),Object.keys(e.c).map((function(n){s[n]=t.vue.withCtx((function(){return t.schema.apply_content(t.str.to_nodes(e.c[n]))}))}))}else o=e.e,r=e.a;return t.vue.createVNode(o,r,s)},n.prototype.apply_content=function(e){var n=this;return e.map((function(e){if(e instanceof Text)return e.wholeText;var o=n.app.is_schema_element(e),r=Object.assign([],e.childNodes);return o?t.schema.wrap_component(n.app.schema.rules(e),r):t.vue.h(e.nodeName,t.obj.getElementAttrs(e),t.schema.apply_content(r))}))},n.prototype.apply_methods=function(e){var n={};return e.e in t.data&&t.data[e.e].map((function(o){n[o]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t.schema.method_request(e,o,n)}})),e.m.length&&e.m.map((function(o){o in n||(n[o]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t.schema.method_request(e,o,n)})})),n},n.prototype.method_request=function(e,n,o,r){var a=this;void 0===r&&(r={});var s={};return o.map((function(t){"object"==typeof t&&(s=i(i({},s),t))})),new Promise((function(c,u){var p;t.request(i({method:"POST",body:t.form_data(i((p={},p[btoa(e.id)]=n,p),s)),headers:{"BFG-TEMPLATE-REQUEST":"true"}},r)).then((function(n){var o=n.data.$schema||{};o.errors={},o.error_message=null,t.event.fire(e.id,o),n.data.$respond&&t.call(n.data.$respond),c(n.data.$response||null)})).catch((function(r){if(419===r.status)t.request().then((function(i){i.token?(a.app.server.token=i.token,c(t.schema.method_request(e,n,o))):u(r)})).catch((function(t){return u(t)}));else{var i=t.json.decode(r.responseText);i&&"errors"in i&&t.event.fire(e.id,{errors:i.errors,error_message:i.message}),u({err:i,xhr:r})}}))}))},n.prototype.clear=function(){t.obj.each(t._cv,(function(e,n){n in t._av&&e.__is_contained()&&(e.$.appContext.app.unmount(),delete t._av[n],delete t._cv[n])}))},n.prototype.content=function(e){var n=this,o=this.app.server.container,r=o?document.getElementById(o):document.body;"object"==typeof e&&"$content"in e?(t.obj.each(e.$configs||[],(function(e,n){t.server[n]=e})),t.obj.each(e.$state||[],(function(e,n){t.event.fire(n,e)})),t.schema.clear(),r.innerHTML=e.$content,e.$respond&&t.call(e.$respond)):(t.schema.clear(),r&&(r.innerHTML="object"==typeof e?t.json.encode(e,2):e)),(r?Object.values(r.childNodes):[]).map((function(t){t instanceof HTMLElement&&n.app.schema.insert(t,n.app.schema.build(t,n.app.schema.rules(t)))}))},n.prototype.insert=function(t,e){t.parentNode&&t.parentNode.replaceChild(e,t)},n.prototype.context=function(t){for(var e=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return this.app.components.context(t,(function(t){return"mixins"in t||(t.mixins=[]),t.mixins.push(c.default(e.app,{id:t.name,a:[],c:null,e:t.name,m:[],v:[]})),t.mixins.concat(n),t}))},n}(t.schema_class)}},607:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=i(n(171)),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="vue",e.require=["commander","schema"],e}return r(e,t),e.prototype.register=function(){this.app.bind("schema_class",a.default(this.app)),this.app.bind("shared_data",this.app.vue.reactive({})),this.app.bind("_cv",{}),this.app.bind("_av",{})},e}((function(t){this.app=t}));e.default=s}},e={};return function n(o){if(e[o])return e[o].exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,n),r.exports}(607)})());