!function(e,t){for(var n in t)e[n]=t[n];t.__esModule&&Object.defineProperty(e,"__esModule",{value:!0})}(exports,(()=>{"use strict";var e={576:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return{data:function(){return{app:e,__contained:!1}},beforeMount:function(){},mounted:function(){e._av[t.id]=this,this.app.server.container&&(this.__contained=this.$el.closest("#"+this.app.server.container))},unmounted:function(){},methods:{}}}},58:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return{bind:{},share:[],save:[],props:{global_rules:{required:!0,type:Object}},data:function(){return{app:e,__contained:!1}},beforeMount:function(){var n=this,o=this.$options.name+(this.$vnode&&this.$vnode.key?"_"+this.$vnode.key:"");e._cv[t.id]=this,Object.keys(t.v).map((function(e){return n[e]=t.v[e]})),this.app.event.on(this.global_rules.id,this.__on_component),e.obj.each(this.$options.save,(function(t){var r="vue-"+o+"-"+t;if(localStorage.getItem(r)){var a=localStorage.getItem(r),i=e.json.decode(a);n[t]=i||a}else localStorage.setItem(r,"object"==typeof n[t]?e.json.encode(n[t]):n[t]);n.$watch(t,(function(o){localStorage.setItem(r,"object"==typeof n[t]?e.json.encode(n[t]):n[t])}))})),e.obj.each(this.$options.share,(function(t,o){e.num.isNumber(o)&&(o=t),e.vue.watch((function(){return n[o]}),(function(n){e.shared_data[t]=n})),e.vue.watch((function(){return e.shared_data[t]}),(function(e){n[o]=e})),t in e.shared_data?n[o]=e.shared_data[t]:e.shared_data[t]=n[o]})),e.obj.each(this.$options.bind,(function(t,o){e.num.isNumber(o)&&(o=t),e.bind(t,n[o])}))},mounted:function(){this.app.server.container&&(this.__contained=!/^w[0-9]+/.test(String(t.id)))},beforeUnmount:function(){this.app.event.off(this.global_rules.id,this.__on_component),e.obj.each(this.$options.bind,(function(t){e.forget(t)}))},methods:{__on_component:function(e){var t=this;this.app.obj.each(e,(function(e,n){"_pn"===n?t.app.obj.each(e,(function(e,n){var o=t.app.obj.get(n,t);"function"==typeof o?o.apply(void 0,Array.isArray(e)?e:[e]):t.app.obj.set(n,e[0],t)})):t[n]=e}))}}}}},171:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,r++)o[r]=a[i];return o},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var c=s(n(58)),u=s(n(576));t.default=function(e){return function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.vue_app=null,e.all_components={},e}return r(n,t),n.prototype.build=function(t,n){var o=this,r=Object.assign([],t.childNodes);return this.all_components=e.components.all(),this.vue_app=e.vue.createApp({mixins:[u.default(e,n)],methods:{unmount:function(){e.vue.render(null,t)}},render:function(){return e.schema.wrap_component(n,r)}}),e.obj.each(this.all_components,(function(e,t){return o.vue_app.component(t,e)})),this.vue_app.mount(t,!0).$el},n.prototype.wrap_component=function(t,n){var o,r,s={default:e.vue.withCtx((function(){return e.schema.apply_content(n)}))};if(t.e in this.all_components){var u=c.default(e,t);(o=e.vue.resolveComponent(t.e)).mixins="mixins"in o?i(o.mixins,[u]):[u],r=a(a({global_rules:t},t.a),e.schema.apply_methods(t)),Object.keys(t.c).map((function(n){s[n]=e.vue.withCtx((function(){return e.schema.apply_content(e.str.to_nodes(t.c[n]))}))}))}else o=t.e,r=t.a;return e.vue.createVNode(o,r,s)},n.prototype.apply_content=function(t){var n=this;return t.map((function(t){if(t instanceof Text)return t.wholeText;var o=n.app.is_schema_element(t),r=Object.assign([],t.childNodes);return o?e.schema.wrap_component(n.app.schema.rules(t),r):e.vue.h(t.nodeName,e.obj.getElementAttrs(t),e.schema.apply_content(r))}))},n.prototype.apply_methods=function(t){var n={};return t.e in e.data&&e.data[t.e].map((function(o){n[o]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e.schema.method_request(t,o,n)}})),t.m.length&&t.m.map((function(o){o in n||(n[o]=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return e.schema.method_request(t,o,n)})})),n},n.prototype.method_request=function(t,n,o,r){var i=this;void 0===r&&(r={});var s={};return o.map((function(e){"object"==typeof e&&(s=a(a({},s),e))})),new Promise((function(c,u){var p;e.request(a({method:"POST",body:e.form_data(a((p={},p[btoa(t.id)]=n,p),s)),headers:{"BFG-TEMPLATE-REQUEST":"true"}},r)).then((function(n){var o=n.data.$schema||{};o.errors={},o.error_message=null,e.event.fire(t.id,o),n.data.$respond&&e.call(n.data.$respond),c(n.data.$response||null)})).catch((function(r){if(419===r.status)e.request().then((function(a){a.token?(i.app.server.token=a.token,c(e.schema.method_request(t,n,o))):u(r)})).catch((function(e){return u(e)}));else{var a=e.json.decode(r.responseText);a&&"errors"in a&&e.event.fire(t.id,{errors:a.errors,error_message:a.message}),u({err:a,xhr:r})}}))}))},n.prototype.redirected=function(t,n){var o=this;e.obj.each(t.$configs||[],(function(t,n){e.server[n]=t})),e.obj.each(t.$state||[],(function(t,n){e.event.fire(n,t)})),e.obj.each(e._av,(function(t,n){t.__contained&&(t.unmount(),delete e._av[n])})),n.innerHTML=t.$content,t.$respond&&e.call(t.$respond),Object.values(n.childNodes).map((function(e){e instanceof HTMLElement&&o.app.schema.insert(e,o.app.schema.build(e,o.app.schema.rules(e)))}))},n}(e.schema_class)}},607:function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(171)),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="vue",t.require=["commander","schema"],t}return r(t,e),t.prototype.register=function(){this.app.bind("schema_class",i.default(this.app)),this.app.bind("shared_data",this.app.vue.reactive({})),this.app.bind("_cv",{}),this.app.bind("_av",{})},t}((function(e){this.app=e}));t.default=s}},t={};return function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}(607)})());